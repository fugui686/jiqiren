import sys, os, json, configparser, requests
from pathlib import Path
from PyQt5.QtCore import Qt, QByteArray, QBuffer, QIODevice
from PyQt5.QtGui import QPixmap, QImage, QKeySequence, QImageReader, QIcon
from PyQt5.QtWidgets import (
    QWidget, QVBoxLayout, QHBoxLayout, QFormLayout, QLabel, QLineEdit, QMessageBox, QShortcut,
    QTextEdit, QPushButton, QGroupBox, QFrame, QSizePolicy, QApplication
)

# ====== ÂÖ®Â±ÄÈÖçÁΩÆ ======
MAX_COLS = 2
PRIORITY_TEXTS = ["ÂÆ¢Êúç", "ÂÆòÁΩë"]   # Âõ∫ÂÆöÂú®ÊúÄ‰∏äÈù¢ÁöÑÊåâÈíÆÊñáÊú¨ÔºåÊåâÊ≠§È°∫Â∫èÊëÜÊîæ
APP_DIR = Path(os.path.abspath(os.path.dirname(__file__)))
CONFIG_PATH = APP_DIR / "config.ini"
BUTTONS_PATH = APP_DIR / "buttons.json"


# -------- utils --------
def normalize_chat_id(s: str) -> str:
    s = s.strip()
    if s.startswith("http://t.me/") or s.startswith("https://t.me/"):
        # https://t.me/xxx Êàñ https://t.me/xxx?start=... -> @xxx
        name = s.split("t.me/", 1)[1].split("?", 1)[0].strip("/")
        if name:
            return "@" + name
    return s


def parse_chat_ids(raw: str):
    """
    ÊîØÊåÅÁî®Ëã±ÊñáÈÄóÂè∑„ÄÅÁ©∫Ê†º„ÄÅÊç¢Ë°åÂàÜÈöîÂ§ö‰∏™È¢ëÈÅìID„ÄÇ
    ÊØè‰∏™IDÈÉΩ‰ºöÂÅö normalizeÔºàhttps://t.me/xxx -> @xxxÔºâ„ÄÇ
    ËøáÊª§Á©∫È°πÂπ∂ÂéªÈáçÔºå‰øùÊåÅÈ°∫Â∫è„ÄÇ
    """
    if not raw:
        return []
    parts = []
    for token in raw.replace("\n", ",").replace(" ", ",").split(","):
        token = token.strip()
        if not token:
            continue
        token = normalize_chat_id(token)
        if token not in parts:
            parts.append(token)
    return parts


def parse_message_ids(raw: str):
    """
    Ëß£ÊûêÊ∂àÊÅØIDÂàóË°®ÔºöÊîØÊåÅ 123,125,130-135 ÂÜôÊ≥ïÔºõÂéªÈáçÂπ∂ÊåâÂçáÂ∫èËøîÂõû int ÂàóË°®„ÄÇ
    """
    ids = set()
    if not raw:
        return []
    raw = raw.replace("Ôºå", ",").replace(" ", "")
    for part in raw.split(","):
        if not part:
            continue
        if "-" in part:
            a, b = part.split("-", 1)
            if a.isdigit() and b.isdigit():
                a, b = int(a), int(b)
                if a > b:
                    a, b = b, a
                ids.update(range(a, b + 1))
        else:
            if part.isdigit():
                ids.add(int(part))
    return sorted(ids)


def _chunk(lst, n):
    return [lst[i:i+n] for i in range(0, len(lst), n)]


def load_buttons():
    """
    ‰ªé buttons.json ËØªÂèñÊåâÈíÆÔºåÂπ∂ÂÅö‰∏§‰ª∂‰∫ãÔºö
    1) ÂÖàÊää PRIORITY_TEXTS ‰∏≠ÁöÑÊåâÈíÆÔºàÊåâÁªôÂÆöÈ°∫Â∫èÔºâÊîæÂà∞Á¨¨‰∏ÄË°åÔºõ
    2) ÂÖ∂‰ΩôÊåâÈíÆÊåâ MAX_COLS Ëá™Âä®ÂàÜË°å„ÄÇ
    ÊîØÊåÅ‰∏âÁßçÂÜôÊ≥ïÔºö{"inline_keyboard":[...]} / ‰∫åÁª¥Êï∞ÁªÑ / ÊâÅÂπ≥Êï∞ÁªÑ„ÄÇ
    """
    if not BUTTONS_PATH.exists():
        return None
    try:
        raw = json.loads(BUTTONS_PATH.read_text(encoding="utf-8"))
        # Áªü‰∏ÄÊãçÂπ≥Êàê‰∏ÄÁª¥ list[dict]
        if isinstance(raw, dict) and "inline_keyboard" in raw:
            kb = raw["inline_keyboard"]
        else:
            kb = raw
        flat = []
        if isinstance(kb, list) and kb and isinstance(kb[0], list):
            for row in kb:
                flat.extend(row)
        else:
            flat = list(kb)

        # ÂéªÈáçÔºàÂü∫‰∫é text + url/callback_dataÔºâ
        seen, dedup = set(), []
        for b in flat:
            t = (b.get("text") or "") + "|" + (b.get("url") or b.get("callback_data") or "")
            if t not in seen:
                seen.add(t)
                dedup.append(b)

        # ÊèêÂèñ‰ºòÂÖàÊåâÈíÆ
        priority, rest = [], dedup.copy()
        def pop_by_text(txt):
            nonlocal rest
            for i, b in enumerate(rest):
                if b.get("text") == txt:
                    return rest.pop(i)
            return None
        for txt in PRIORITY_TEXTS:
            picked = pop_by_text(txt)
            if picked:
                priority.append(picked)

        rows = []
        if priority:
            rows.extend(_chunk(priority, MAX_COLS))
        if rest:
            rows.extend(_chunk(rest, MAX_COLS))
        return {"inline_keyboard": rows}
    except Exception:
        return None


def save_config(token, channel):
    cfg = configparser.ConfigParser()
    cfg["TELEGRAM"] = {"bot_token": token.strip(), "channel_id": channel.strip()}
    with open(CONFIG_PATH, "w", encoding="utf-8") as f:
        cfg.write(f)


def load_config():
    if not CONFIG_PATH.exists():
        return "", ""
    cfg = configparser.ConfigParser()
    cfg.read(CONFIG_PATH, encoding="utf-8")
    return cfg.get("TELEGRAM", "bot_token", fallback=""), cfg.get("TELEGRAM", "channel_id", fallback="")


# -------- Telegram API Â∞ÅË£Ö --------
def send_message(bot_token, chat_id, text, keyboard=None):
    url = f"https://api.telegram.org/bot{bot_token}/sendMessage"
    payload = {"chat_id": chat_id, "text": text, "parse_mode": "HTML"}
    if keyboard:
        payload["reply_markup"] = keyboard
    return requests.post(url, json=payload, timeout=20).json()


def send_photo(bot_token, chat_id, image_bytes, caption="", keyboard=None):
    url = f"https://api.telegram.org/bot{bot_token}/sendPhoto"
    files = {"photo": ("image.png", image_bytes, "image/png")}
    data = {"chat_id": chat_id}
    if caption:
        data["caption"] = caption
        data["parse_mode"] = "HTML"
    if keyboard:
        data["reply_markup"] = json.dumps(keyboard, ensure_ascii=False)
    return requests.post(url, data=data, files=files, timeout=30).json()


def edit_buttons(bot_token, chat_id, message_id, keyboard):
    url = f"https://api.telegram.org/bot{bot_token}/editMessageReplyMarkup"
    payload = {"chat_id": chat_id, "message_id": message_id, "reply_markup": keyboard}
    return requests.post(url, json=payload, timeout=20).json()


# -------- image area --------
class PasteDropImage(QWidget):
    """ÊîØÊåÅ Ctrl+V Á≤òË¥¥ Âíå ÊãñÊãΩ ÂõæÁâáÁöÑÈ¢ÑËßàÂå∫"""
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setAcceptDrops(True)
        self.setFocusPolicy(Qt.StrongFocus)  # ÂÖÅËÆ∏Êé•Êî∂Âø´Êç∑ÈîÆ
        self.image_bytes = None

        self.box = QVBoxLayout(self)
        self.box.setContentsMargins(0, 0, 0, 0)
        self.box.setSpacing(8)

        # È¢ÑËßàÊ†áÁ≠æ
        self.label = QLabel("Âú®Ê≠§Â§ÑÁÇπÂáªÂπ∂ Ctrl+V Á≤òË¥¥ÂõæÁâáÔºàÂèØÈÄâÔºâ\nÊàñÊääÂõæÁâáÊñá‰ª∂ÊãñËøõÊù•\n‰∏çÊîæÂõæÂàô‰ªÖÂèëÈÄÅÊñáÂ≠ó")
        self.label.setAlignment(Qt.AlignCenter)
        self.label.setMinimumHeight(200)
        self.label.setFrameShape(QFrame.StyledPanel)
        self.label.setStyleSheet("QLabel { background:#fafafa; color:#666; }")
        self.box.addWidget(self.label)

        # Âè≥‰∏ãËßí‚ÄúÊ∏ÖÁ©∫ÂõæÁâá‚ÄùÊåâÈíÆ
        self.clear_btn = QPushButton("Ê∏ÖÁ©∫ÂõæÁâá")
        self.clear_btn.setEnabled(False)
        self.clear_btn.clicked.connect(self.clear_image)
        hb = QHBoxLayout()
        hb.addStretch()
        hb.addWidget(self.clear_btn)
        hb.setContentsMargins(6, 0, 6, 6)
        self.box.addLayout(hb)

        # Á≤òË¥¥Âø´Êç∑ÈîÆ
        QShortcut(QKeySequence.Paste, self, activated=self.handle_paste)

    def mousePressEvent(self, e):
        self.setFocus()  # ÁÇπÂáªËé∑ÂèñÁÑ¶ÁÇπÔºåÊñπ‰æø Ctrl+V
        super().mousePressEvent(e)

    # ---- Á≤òË¥¥ ----
    def handle_paste(self):
        cb = QApplication.clipboard()
        mime = cb.mimeData()
        # Áõ¥Êé•Á≤òË¥¥‰ΩçÂõæ
        if mime and mime.hasImage():
            qimg = cb.image()
            if not qimg.isNull():
                self._set_qimage(qimg)
                return
        # Á≤òË¥¥Êñá‰ª∂Ë∑ØÂæÑ
        if mime and mime.hasUrls():
            for u in mime.urls():
                local = u.toLocalFile()
                if local and self._try_load_file(local):
                    return
        QMessageBox.information(self, "ÊèêÁ§∫", "Ââ™Ë¥¥Êùø‰∏≠Êú™Ê£ÄÊµãÂà∞ÂõæÁâá„ÄÇ")

    # ---- ÊãñÊãΩ ----
    def dragEnterEvent(self, e):
        mime = e.mimeData()
        if (mime.hasImage()) or (mime.hasUrls()):
            e.acceptProposedAction()

    def dropEvent(self, e):
        mime = e.mimeData()
        # Áõ¥Êé•ÊãñÂÖ•‰ΩçÂõæÔºàÂ∞ëËßÅÔºâ
        if mime.hasImage():
            qimg = QImage(mime.imageData())
            if not qimg.isNull():
                self._set_qimage(qimg)
                return
        # ÊãñÂÖ•Êñá‰ª∂
        if mime.hasUrls():
            for u in mime.urls():
                local = u.toLocalFile()
                if local and self._try_load_file(local):
                    return

    # ---- helpers ----
    def _try_load_file(self, path: str) -> bool:
        reader = QImageReader(path)
        qimg = reader.read()
        if not qimg.isNull():
            self._set_qimage(qimg)
            return True
        return False

    def _set_qimage(self, qimg: QImage):
        # È¢ÑËßàÔºàÁ≠âÊØîÁº©ÊîæÔºâ
        pix = QPixmap.fromImage(qimg)
        scaled = pix.scaled(720, 720, Qt.KeepAspectRatio, Qt.SmoothTransformation)
        self.label.setPixmap(scaled)
        self.label.setToolTip("Â∑≤Âä†ËΩΩ‰∏ÄÂº†ÂõæÁâáÔºåÂ∞Ü‰∏éÊ∂àÊÅØ‰∏ÄÂπ∂ÂèëÈÄÅ„ÄÇ")

        # ËΩ¨ PNG bytesÔºàÁî® Qt ÁöÑ QBufferÔºâ
        ba = QByteArray()
        buf = QBuffer(ba)
        buf.open(QIODevice.WriteOnly)
        qimg.save(buf, "PNG")
        buf.close()
        self.image_bytes = bytes(ba)
        self.clear_btn.setEnabled(True)

    def clear_image(self):
        self.image_bytes = None
        self.label.setPixmap(QPixmap())
        self.label.setText("Âú®Ê≠§Â§ÑÁÇπÂáªÂπ∂ Ctrl+V Á≤òË¥¥ÂõæÁâáÔºàÂèØÈÄâÔºâ\nÊàñÊääÂõæÁâáÊñá‰ª∂ÊãñËøõÊù•\n‰∏çÊîæÂõæÂàô‰ªÖÂèëÈÄÅÊñáÂ≠ó")
        self.clear_btn.setEnabled(False)


# -------- main window --------
class MainWindow(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Telegram È¢ëÈÅìÂèëÈÄÅÂô®")
        self.resize(1000, 820)

        # üåê ËÅîÁΩëÈ™åËØÅ + Êó∂Èó¥È™åËØÅ
        self.check_network_validation()

        # Âä†ËΩΩ base64 ÂõæÊ†áÔºàÁ°Æ‰øùÂ≠óÁ¨¶‰∏≤ÂÆåÊï¥Ôºâ
        icon_base64 = "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//8iV///Ilf//yJX//8iV///Ilf//yJW//IiV/+HGFX/FQAAAAAAAAAAAAAAACFV/ychV//OIlf/5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIVj/PSFW/88iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV//2Ilf/ryJX/5AiV/+1Ilf/+iJX//8iV//aAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJEn/ByFW/5IiVv/+Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/6UAAAAAAAAAAAAAAAAAAAAAAAAAACBV/xghVv/JIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf/TAAAAAAAAAAAAAAAAAAAAAAhWv8fIVf/3SJX//8iV///Ilf//yJX/+giVv+9IVf/oSJX/5YiV/+cIlb/tCJX/98iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yFX/84AAP8BAAAAAAAAAAAAAAAAIVn/FyJX/9wiV///Ilb/ySJV/28jVf8kAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFS/x8hV/91Ilf/4CJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8hV//8IFf/OAAAAAAAAAAAAAAAACpV/wYiV//FIlf/rSJY/zQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACpV/wYgVv+OIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJW/4gAAAAAAAAAAAAAAAAAAAAAIVf/VSBT/zcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAhWf8XIlf/xSJX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AAAAAAAAIlb/dyJX//8hVv/PG1H/EwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIGD/CABV/wMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABxV/wkhV//lIVf/wh5a/xEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIVj/eiJX/5wkSf8HAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFZ/xciVv9TAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AUBA/wQqVf8GJEn/BzNm/wUAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wEgUP8QHlX/MyJW/1MhWP9rIlf/fiNW/4whV/+SIVb/lCJX/40iVv9/I1f/ZiJW/0QgVf8YAAD/AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFT/y4hWf8XAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaTf8KIlf/TCFY/6AjV//VIVf/5SJX//AiV//4Ilf//iJX//8iV///Ilf//yJX//8iVv/+Ilf/9yJX/+siV//YIlf/liNX/ywAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJFv/KiJX/9AjV/9JAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcVf8JHVf/IyFW/3whV//fIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJW//ghVv+gIVf/Lxdd/wsAAAAAAAAAAAAAAAAAAAAAAAAAACpV/wYkWP9AIVj/3SJX//UhWP9jAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACNU/zoiVv+UIlf/5CJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf/6iJX/54gWP9XIlP/JSBg/xAcVf8bI1X/QiFX/4oiV//iIlf//yJX//YhVv9lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbXv8TIlf/kCJX/+giV//8Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//4iV//xIlf/4SJX/9ohV//dIlf/6iJX//wiV///Ilf//yJX//EhV/9VAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQED/BCBY/zciV//IIlf//iJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yNX/+UkV/8yAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgUP8QIVb/cyJX/+ciV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJW/8MaTf8KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACdi/w0iV/+VIlf/9iJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/2EAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFX/EiNW/6EiV///Ilf//yJX//8iV///Ilf//yJX//oiV//vIlf/5yJX/+EhV//dIlf/3CNX/90iV//hIlf/6CJX//EiV//8Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf/0kBA/wQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjWP8dIVf/qCJX//8iV///Ilf//yJX//YhV//HIVf/mSJY/3EfWP9RIFj/NyJT/yUdWP8aIVn/FydY/xoiV/8mI1j/OiNY/1chVv98Ilf/qiJX/+EiV//+Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iVv/vIlf/TAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACdO/w0hWP+aIlf/+yJX//8iV//nIVb/iyRX/zIgVf8YHFX/CQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgP8CJFv/DiJa/yUhVv9zIlf/6CJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//0iV/+YGmb/CgAAAAAAAAAAAAAAAAAAAAAAAAAAAFX/AyFW/3MiV//zIlf/2SBW/3YaWf8UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wEcVf8SIlf/gSJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/9giU/8lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIFf/WCJW/8MgV/9vHVj/GgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACJb/y0iV/+tIlf/+SJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/74AQP8EAAAAAAAAAAAAAAAAAAAAAAAAAAAgWP8gIlb/WR1Y/xoAVf8DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIFT/QCFX/94iV//9Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/+AiWv8lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBA/wQiVv9TIlj/6yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yFX/+0iVv9KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACJX/2EiV//iIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//YhWP9jAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8BI1f/bCJX//EiV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//shVv90AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBA/wQhWP9jIlf/8SJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//0hV/97AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFX/1UiVv/PIFn/PwBA/wQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFX/EiJX/58hVf8nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIlP/JSJV/w8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="  # ÊõøÊç¢Êàê‰Ω†ÁöÑ base64
        icon_data = QByteArray.fromBase64(icon_base64.encode())

        # Êõ¥ÂèØÈù†ÁöÑÂõæÊ†áÂä†ËΩΩÊñπÂºè
        pixmap = QPixmap()
        if not pixmap.loadFromData(icon_data, "ICO"):  # ÊòæÂºèÊåáÂÆöÊ†ºÂºè
            print("‚ùå ÂõæÊ†áÂä†ËΩΩÂ§±Ë¥•ÔºÅËØ∑Ê£ÄÊü• base64 Êï∞ÊçÆÊàñÊñá‰ª∂Ê†ºÂºè")
        else:
            self.setWindowIcon(QIcon(pixmap))  # ËÆæÁΩÆÁ™óÂè£Âíå‰ªªÂä°Ê†èÂõæÊ†á

        # ====== ÂÖ®Â±ÄÊ†∑Âºè ======
        self.setStyleSheet("""
            QWidget {
                font-family: "Microsoft YaHei", "Segoe UI", "PingFang SC", sans-serif;
                font-size: 14px;
            }
            QGroupBox {
                font-weight: 600;
                border: 1px solid #e6e6e6;
                border-radius: 10px;
                margin-top: 12px;
                padding: 14px 16px 12px 16px;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                subcontrol-position: top left;
                padding: 0 6px;
                color: #333;
                background: transparent;
            }
            QLabel.tip {
                color: #888;
                font-size: 12px;
            }
            QLineEdit, QTextEdit {
                border: 1px solid #dcdcdc;
                border-radius: 8px;
                padding: 6px 10px;
                background: #fff;
            }
            QLineEdit:focus, QTextEdit:focus {
                border: 1px solid #6aa8ff;
                box-shadow: 0 0 0 3px rgba(106,168,255,0.15);
            }
            QTextEdit { min-height: 140px; }

            QPushButton {
                border: 0;
                border-radius: 10px;
                padding: 9px 16px;
                background: #f2f3f5;
            }
            QPushButton:hover { background: #e9eaee; }
            QPushButton:pressed { background: #e2e3e7; }

            QPushButton#primary { background: #1677ff; color: #fff; font-weight: 600; }
            QPushButton#primary:hover { background: #3a8bff; }
            QPushButton#primary:pressed { background: #0f66dd; }

            QWidget#imageArea {
                border: 1px dashed #cfcfcf;
                border-radius: 10px;
                background: #fafafa;
                min-height: 160px;
            }

            QLabel#statusBar { color: #666; }

            QFrame#line {
                color: #eee; background: #eee;
                min-height: 1px; max-height: 1px;
            }
        """)

        # ====== Âü∫Á°ÄÈÖçÁΩÆ ======
        cfg_box = QGroupBox("Âü∫Á°ÄÈÖçÁΩÆ")
        cfg_form = QFormLayout()
        cfg_form.setLabelAlignment(Qt.AlignRight)
        cfg_form.setFormAlignment(Qt.AlignLeft)
        cfg_form.setHorizontalSpacing(14)
        cfg_form.setVerticalSpacing(10)

        self.token_edit = QLineEdit()
        self.token_edit.setPlaceholderText("Êú∫Âô®‰∫∫ TokenÔºàÊù•Ëá™ @BotFatherÔºâ")
        self.channel_edit = QLineEdit()
        self.channel_edit.setPlaceholderText("È¢ëÈÅìIDÔºö@username Êàñ -100xxxxxxxxxxÔºàÂèØÂ°´Â§ö‰∏™ÔºåÁî®ÈÄóÂè∑ÂàÜÈöîÔºâ")

        token, channel = load_config()
        self.token_edit.setText(token)
        self.channel_edit.setText(channel)

        cfg_form.addRow(QLabel("Êú∫Âô®‰∫∫ TokenÔºö"), self.token_edit)
        cfg_form.addRow(QLabel("È¢ëÈÅì IDÔºö"), self.channel_edit)
        cfg_box.setLayout(cfg_form)

        # ====== Ê∂àÊÅØÂÜÖÂÆπ ======
        msg_box = QGroupBox("Ê∂àÊÅØÂÜÖÂÆπ")
        msg_v = QVBoxLayout()
        self.msg_edit = QTextEdit()
        self.msg_edit.setAcceptRichText(False)
        self.msg_edit.setPlaceholderText("ËæìÂÖ•Ë¶ÅÂèëÈÄÅÁöÑÂ∏ñÂ≠êÔºàÊîØÊåÅ HTMLÔºå‰æãÂ¶Ç <b>Âä†Á≤ó</b>Ôºâ")
        msg_v.addWidget(self.msg_edit)
        tip = QLabel("<a href='https://t.me/fugui500'>ËÅîÁ≥ªÊàë")
        tip.setOpenExternalLinks(True)
        msg_v.addWidget(tip, 0, Qt.AlignLeft)
        msg_box.setLayout(msg_v)

        # ====== ÂõæÁâáÂå∫ ======
        img_box = QGroupBox("ÂõæÁâáÔºàÂèØÈÄâÔºöCtrl+V Á≤òË¥¥ Êàñ Áõ¥Êé•ÊãñÊãΩÊñá‰ª∂Ôºâ")
        img_v = QVBoxLayout()
        self.image_area = PasteDropImage()
        self.image_area.setObjectName("imageArea")
        self.image_area.setSizePolicy(QSizePolicy.Expanding, QSizePolicy.Expanding)
        img_v.addWidget(self.image_area)
        img_box.setLayout(img_v)

        # ====== ÂêåÊ≠•ÊóßÂ∏ñÊåâÈíÆÂå∫ ======
        sync_row = QHBoxLayout()
        self.msgids_edit = QLineEdit()
        self.msgids_edit.setPlaceholderText("Ë¶ÅÂêåÊ≠•ÁöÑÊ∂àÊÅØIDÔºàÊîØÊåÅ 123,125,130-135Ôºâ")
        self.sync_btn = QPushButton("ÂêåÊ≠•ÊåâÈíÆÂà∞ÊóßÂ∏ñ")
        sync_row.addWidget(QLabel("Ê∂àÊÅØIDÔºö"))
        sync_row.addWidget(self.msgids_edit)
        sync_row.addWidget(self.sync_btn)

        # ÂàÜÈöîÁ∫ø
        line = QFrame()
        line.setObjectName("line")
        line.setFrameShape(QFrame.HLine)
        line.setFrameShadow(QFrame.Plain)

        # ====== Â∫ïÈÉ®Êìç‰ΩúÂå∫ ======
        self.save_btn = QPushButton("üíæ ‰øùÂ≠òÈÖçÁΩÆ")
        self.save_btn.setObjectName("primary")
        self.send_btn = QPushButton("üì§ ÂèëÈÄÅÊ∂àÊÅØ")
        self.send_btn.setObjectName("primary")

        btn_bar = QHBoxLayout()
        btn_bar.addStretch()
        btn_bar.addWidget(self.save_btn)
        btn_bar.addWidget(self.send_btn)

        self.status = QLabel("ÂáÜÂ§áÂ∞±Áª™")
        self.status.setObjectName("statusBar")

        bottom = QHBoxLayout()
        bottom.addWidget(self.status, 1, Qt.AlignLeft)
        bottom.addLayout(btn_bar, 0)

        # ====== Ê†πÂ∏ÉÂ±Ä ======
        root = QVBoxLayout(self)
        root.setContentsMargins(12, 10, 12, 12)
        root.addWidget(cfg_box)
        root.addWidget(msg_box)
        root.addWidget(img_box)
        root.addLayout(sync_row)   # ÂêåÊ≠•ÊóßÂ∏ñË°å
        root.addWidget(line)
        root.addLayout(bottom)

        # ‰∫ã‰ª∂
        self.save_btn.clicked.connect(self.on_save)
        self.send_btn.clicked.connect(self.on_send)
        self.sync_btn.clicked.connect(self.on_sync_buttons)

        # ÁªÜËäÇ
        self.send_btn.setAutoDefault(True)
        self.send_btn.setDefault(True)
        self.setTabOrder(self.token_edit, self.channel_edit)
        self.setTabOrder(self.channel_edit, self.msg_edit)
        self.setTabOrder(self.msg_edit, self.send_btn)

    def check_network_validation(self):
        try:
            program_id = "Telegram_fsq"  # ÊØè‰∏™Á®ãÂ∫èÁî®Ëá™Â∑±ÁöÑÂêçÂ≠óÔºàÂøÖÈ°ªÂíåJSONÊñá‰ª∂ÈáåÁöÑ key ÂØπÂ∫îÔºâ
            response = requests.get("http://8.210.92.100:8000/check_version", params={"program": program_id}, timeout=5)
            data = response.json()

            status = data.get("status")

            if status != "active":
                QMessageBox.critical(self, "ÁâàÊú¨ËøáÊúü", "ÂΩìÂâçÁâàÊú¨Â∑≤ËøáÊúüÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòËé∑ÂèñÊúÄÊñ∞ÁâàÊú¨")
                sys.exit(0)

        except Exception:
            QMessageBox.critical(self, "ÂÖºÂÆπÊÄßÈîôËØØ", "ÁªÑ‰ª∂ËøûÊé•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØïÔºàCode: S-2Ôºâ")
            sys.exit(0)

    def on_save(self):
        token = self.token_edit.text().strip()
        channel = normalize_chat_id(self.channel_edit.text().strip())
        if not token or not channel:
            QMessageBox.warning(self, "ÊèêÁ§∫", "ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑ Bot Token Âíå È¢ëÈÅìID„ÄÇ")
            return
        try:
            save_config(token, channel)
            QMessageBox.information(self, "ÊàêÂäü", f"‚úÖ ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò")
        except Exception as e:
            QMessageBox.critical(self, "ÈîôËØØ", f"‰øùÂ≠òÂ§±Ë¥•Ôºö{e}")

    def on_send(self):
        bot_token = self.token_edit.text().strip()
        raw_ids = self.channel_edit.text().strip()
        text = self.msg_edit.toPlainText().strip()
        keyboard = load_buttons()

        chat_ids = parse_chat_ids(raw_ids)

        if not bot_token or not chat_ids:
            QMessageBox.warning(self, "ÊèêÁ§∫", "ËØ∑ÂÖàÂ°´ÂÜô Bot Token Âíå Ëá≥Â∞ë‰∏Ä‰∏™È¢ëÈÅìID„ÄÇ")
            return
        if not text and not getattr(self, "image_area", None).image_bytes:
            QMessageBox.warning(self, "ÊèêÁ§∫", "ËØ∑Ëá≥Â∞ëËæìÂÖ•ÊñáÂ≠óÊàñÁ≤òË¥¥/ÊãñÂÖ•‰∏ÄÂº†ÂõæÁâá„ÄÇ")
            return

        self.setEnabled(False)
        self.status.setText("ÂèëÈÄÅ‰∏≠‚Ä¶")

        results = []
        try:
            for cid in chat_ids:
                if cid.startswith("http"):
                    results.append((cid, False, "È¢ëÈÅìID‰∏çË¶ÅÂ°´ÈìæÊé•ÔºåËØ∑Â°´ @Áî®Êà∑Âêç Êàñ -100xxxxxxxxxx"))
                    continue

                if getattr(self, "image_area", None).image_bytes:
                    # ÂèëÂõæÁâá +ÔºàÂèØÈÄâÔºâÊñáÂ≠ó‰Ωú‰∏∫ caption
                    resp = send_photo(
                        bot_token, cid,
                        self.image_area.image_bytes,
                        caption=text or "",
                        keyboard=keyboard
                    )
                else:
                    # Âè™ÂèëÊñáÂ≠ó
                    resp = send_message(
                        bot_token, cid,
                        text=text,
                        keyboard=keyboard
                    )

                if resp.get("ok"):
                    results.append((cid, True, f"message_id={resp['result']['message_id']}"))
                else:
                    results.append((cid, False, resp.get("description", "unknown error")))
        except Exception as e:
            results.append(("__internal__", False, str(e)))
        finally:
            self.setEnabled(True)
            self.status.setText("ÂáÜÂ§áÂ∞±Áª™")

        # Ê∏ÖÂõæÔºàËã•ÊúâÔºâ
        if getattr(self, "image_area", None).image_bytes:
            self.image_area.clear_image()

        # Ê±áÊÄªÂºπÁ™ó
        ok_lines = [f"‚úÖ {cid}  {info}" for cid, ok, info in results if ok]
        bad_lines = [f"‚ùå {cid}  {info}" for cid, ok, info in results if not ok]
        msg = []
        if ok_lines:
            msg.append("ÊàêÂäüÔºö\n" + "\n".join(ok_lines))
        if bad_lines:
            msg.append("\nÂ§±Ë¥•Ôºö\n" + "\n".join(bad_lines))
        QMessageBox.information(self, "ÂèëÈÄÅÁªìÊûú", "\n".join(msg) if msg else "Êó†ÁªìÊûú")

    def on_sync_buttons(self):
        """ÊääÂΩìÂâç buttons.json ÂêåÊ≠•Âà∞ÊåáÂÆöÊóßÂ∏ñÔºà‰∏çÂèëÊñ∞Â∏ñÔºâ"""
        bot_token = self.token_edit.text().strip()
        chat_ids = parse_chat_ids(self.channel_edit.text().strip())
        ids_text = self.msgids_edit.text().strip()
        message_ids = parse_message_ids(ids_text)
        keyboard = load_buttons()

        if not bot_token or not chat_ids:
            QMessageBox.warning(self, "ÊèêÁ§∫", "ËØ∑ÂÖàÂ°´ÂÜô Bot Token Âíå È¢ëÈÅìID„ÄÇ")
            return
        if not message_ids:
            QMessageBox.warning(self, "ÊèêÁ§∫", "ËØ∑ËæìÂÖ•Ë¶ÅÂêåÊ≠•ÁöÑÊ∂àÊÅØIDÔºàÂèØÂ°´Â§ö‰∏™ÔºåÊîØÊåÅÂå∫Èó¥Ôºâ„ÄÇ")
            return
        if not keyboard:
            QMessageBox.warning(self, "ÊèêÁ§∫", "Êú™ËØªÂèñÂà∞ buttons.json„ÄÇ")
            return

        self.setEnabled(False)
        self.status.setText("ÂêåÊ≠•‰∏≠‚Ä¶")
        results = []
        try:
            for cid in chat_ids:
                if cid.startswith("http"):
                    results.append((cid, False, "È¢ëÈÅìID‰∏çË¶ÅÂ°´ÈìæÊé•ÔºåËØ∑Â°´ @Áî®Êà∑Âêç Êàñ -100..."))
                    continue
                for mid in message_ids:
                    resp = edit_buttons(bot_token, cid, mid, keyboard)
                    if resp.get("ok"):
                        results.append((f"{cid}#{mid}", True, "ok"))
                    else:
                        results.append((f"{cid}#{mid}", False, resp.get("description", "unknown error")))
        finally:
            self.setEnabled(True)
            self.status.setText("ÂáÜÂ§áÂ∞±Áª™")

        ok_lines  = [f"‚úÖ {k}" for k, ok, _ in results if ok]
        bad_lines = [f"‚ùå {k}  {msg}" for k, ok, msg in results if not ok]
        QMessageBox.information(
            self, "ÂêåÊ≠•ÁªìÊûú",
            ("ÊàêÂäüÔºö\n" + "\n".join(ok_lines) if ok_lines else "") +
            ("\n\nÂ§±Ë¥•Ôºö\n" + "\n".join(bad_lines) if bad_lines else "")
        )


def ensure_sample_buttons_json():
    if not BUTTONS_PATH.exists():
        sample = {
            "inline_keyboard": [
                [
                    {"text": "ÂÆ¢Êúç", "url": "http://1.1.1.1"},
                    {"text": "ÂÆòÁΩë", "url": "http://1.1.1.1"}
                ]
            ]
        }
        BUTTONS_PATH.write_text(
            json.dumps(sample, ensure_ascii=False, indent=2),
            encoding="utf-8"
        )


if __name__ == "__main__":
    ensure_sample_buttons_json()
    app = QApplication(sys.argv)
    w = MainWindow()
    w.show()
    sys.exit(app.exec_())
